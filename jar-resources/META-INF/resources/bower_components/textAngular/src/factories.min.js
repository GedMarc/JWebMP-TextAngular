
angular.module("textAngular.factories",[]).factory("taBrowserTag",[function(){return function(a){if(!a){return(_browserDetect.ie<=8)?"P":"p"}else{if(a===""){return(_browserDetect.ie===undefined)?"div":(_browserDetect.ie<=8)?"P":"p"}else{return(_browserDetect.ie<=8)?a.toUpperCase():a}}}}]).factory("taApplyCustomRenderers",["taCustomRenderers","taDOM",function(b,a){return function(d){var c=angular.element("<div></div>");c[0].innerHTML=d;angular.forEach(b,function(f){var e=[];if(f.selector&&f.selector!==""){e=c.find(f.selector)}else{if(f.customAttribute&&f.customAttribute!==""){e=a.getByAttribute(c,f.customAttribute)}}angular.forEach(e,function(g){g=angular.element(g);if(f.selector&&f.selector!==""&&f.customAttribute&&f.customAttribute!==""){if(g.attr(f.customAttribute)!==undefined){f.renderLogic(g)}}else{f.renderLogic(g)}})});return c[0].innerHTML}}]).factory("taFixChrome",function(){var a=function(f,e){if(!f||!angular.isString(f)||f.length<=0){return f}var i=/style\s?=\s?(["'])(?:(?=(\\?))\2.)*?\1/ig;var d=/<([^>\/]+?)style=("([^\"]+)"|'([^']+)')([^>]*)>/ig;var k=/<span class="Apple-converted-space">([^<]+)<\/span>/ig;var g,l,j,m,c="",h=0;while(g=k.exec(f)){j=g[1];j=j.replace(/&nbsp;/ig," ");c+=f.substring(h,g.index)+j;h=g.index+g[0].length}if(h){c+=f.substring(h);f=c;c="";h=0}if(!e){while(g=i.exec(f)){c+=f.substring(h,g.index-1);l=g[0];g=/font-family: inherit;|line-height: 1.[0-9]{3,12};|color: inherit; line-height: 1.1;|color: rgb\(\d{1,3}, \d{1,3}, \d{1,3}\);|background-color: rgb\(\d{1,3}, \d{1,3}, \d{1,3}\);/gi.exec(l);if(g){l=l.replace(/( |)font-family: inherit;|( |)line-height: 1.[0-9]{3,12};|( |)color: inherit;|( |)color: rgb\(\d{1,3}, \d{1,3}, \d{1,3}\);|( |)background-color: rgb\(\d{1,3}, \d{1,3}, \d{1,3}\);/ig,"");if(l.length>8){c+=" "+l}}else{c+=" "+l}h=i.lastIndex}c+=f.substring(h)}if(h>0){var b=c.replace(/<span\s?>(.*?)<\/span>(<br(\/|)>|)/ig,"$1");return b}else{return f}};return a}).factory("taSanitize",["$sanitize",function taSanitizeFactory(l){var n=[{property:"font-weight",values:["bold"],tag:"b"},{property:"font-style",values:["italic"],tag:"i"}];var h=[];for(var e=0;e<n.length;e++){var k="("+n[e].property+":\\s*(";for(var d=0;d<n[e].values.length;d++){if(d>0){k+="|"}k+=n[e].values[d]}k+=");)";h.push(k)}var b="("+h.join("|")+")";function f(q,j){var s=0;var t=0;var i;var r=/<[^>]*>/ig;while(i=r.exec(q)){t=i.index;if(i[0].substr(1,1)==="/"){if(s===0){break}else{s--}}else{s++}}return j+q.substring(0,t)+angular.element(j)[0].outerHTML.substring(j.length)+q.substring(t)}function m(t){if(!t||!angular.isString(t)||t.length<=0){return t}var s;var w=/<([^>\/]+?)style=("([^"]+)"|'([^']+)')([^>]*)>/ig;var u,r,y,A,x="",j,q="",v=0;while(u=w.exec(t)){y=u[3]||u[4];var z=new RegExp(b,"i");if(angular.isString(y)&&z.test(y)){A="";var B=new RegExp(b,"ig");while(r=B.exec(y)){for(s=0;s<n.length;s++){if(!!r[(s*2)+2]){A+="<"+n[s].tag+">"}}}j=m(t.substring(v,u.index));if(x.length>0){q+=f(j,x)}else{q+=j}y=y.replace(new RegExp(b,"ig"),"");q+="<"+u[1].trim();if(y.length>0){q+=' style="'+y+'"'}q+=u[5]+">";v=u.index+u[0].length;x=A}}if(x.length>0){q+=f(t.substring(v),x)}else{q+=t.substring(v)}return q}function c(q){if(!q||!angular.isString(q)||q.length<=0){return q}var j=/<([^>\/]+?)align=("([^"]+)"|'([^']+)')([^>]*)>/ig;var i,s="",t=0;while(i=j.exec(q)){s+=q.substring(t,i.index);t=i.index+i[0].length;var r="<"+i[1]+i[5];if(/style=("([^"]+)"|'([^']+)')/ig.test(r)){r=r.replace(/style=("([^"]+)"|'([^']+)')/i,'style="$2$3 text-align:'+(i[3]||i[4])+';"')}else{r+=' style="text-align:'+(i[3]||i[4])+';"'}r+=">";s+=r}return s+q.substring(t)}var a=new RegExp(/<span id="selectionBoundary_\d+_\d+" class="rangySelectionBoundary">[^<>]+?<\/span>/ig);var p=new RegExp(/<span class="rangySelectionBoundary" id="selectionBoundary_\d+_\d+">[^<>]+?<\/span>/ig);var o=new RegExp(/<span id="selectionBoundary_\d+_\d+" class="rangySelectionBoundary">[^<>]+?<\/span>/ig);return function g(t,x,w){if(!w){try{t=m(t)}catch(v){}}t=c(t);if(t){try{t=t.replace(a,"");t=t.replace(p,"");t=t.replace(a,"");t=t.replace(o,"")}catch(v){}}var j;try{j=l(t);if(w){j=t}}catch(v){j=x||""}var i=j.match(/(<pre[^>]*>.*?<\/pre[^>]*>)/ig);var r=j.replace(/(&#(9|10);)*/ig,"");var y=/<pre[^>]*>.*?<\/pre[^>]*>/ig;var u=0;var s=0;var q;j="";while((q=y.exec(r))!==null&&u<i.length){j+=r.substring(s,q.index)+i[u];s=q.index+q[0].length;u++}return j+r.substring(s)}}]).factory("taToolExecuteAction",["$q","$log",function(a,b){return function(f){if(f!==undefined){this.$editor=function(){return f}}var e=a.defer(),h=e.promise,g=this.$editor();var d;try{d=this.action(e,g.startAction());h["finally"](function(){g.endAction.call(g)})}catch(c){b.error(c)}if(d||d===undefined){e.resolve()}}}]);

 
